<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Settings">
  <meta name="author" content="Josh Shirley">
  <link rel="icon" type="image/x-icon" href="media/favicon.ico">
  <title>Settings</title>
  <!-- Add in icon links -->

  <!-- Style Sheets -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <link rel="stylesheet" href="style/style.css?v=2">

  <style>
    .form-label {
      font-weight: 500;
    }

    h6 {
      /* border-top: 1px solid black; */
      padding-top: 1rem;
      border-bottom: 1px solid;
      padding-bottom: 1rem;
      background-color: honeydew;
      padding-left: 6px;
      font-weight: 700;
    }
  </style>
  <!-- JavaScript links -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

  <script src="script/URLcontroller.js"></script>
  <script src="script/swiper.js"></script>
  <script src="script/htmlbuilder.js"></script>
  <script src="script/errorView.js?v=1"></script>
</head>

<body class="d-flex flex-column min-vh-100">
  <header class="py-3 mb-3 border-bottom">
    <div class="container d-flex flex-wrap justify-content-between">
      <a href="/index.html" id="title-date" class="align-items-left mb-1 mb-md-0 me-md-auto fs-5"
        style="padding-top:4px;">
        Ski Gaupo
      </a>
      <ul class="nav nav-underline">
        <li class="nav-item"><a href="schedule.html" class="nav-link" aria-current="page">Schedule</a></li>
        <li class="nav-item"><a href="guests.html" class="nav-link active">Guests</a></li>
      </ul>
    </div>
  </header>
  <main>
    <div class="container-fluid" id="instructor">
      <div class="row headerRow pb-4">
        <div class="col-12" class="showDate">
        </div>
        <div class="col-12">
          Josh Shirley Canyons Village
        </div>
      </div>
    </div>

    <div class="container" id="content">

      <div class="mb-3">
        <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapsePrivacy" role="button" aria-expanded="false"
          aria-controls="collapsePrivacy">
          Privacy Policy
        </a>

        <div class="collapse" id="collapsePrivacy">
          <div class="card card-body">
            <p>Settings data is saved locally on your device. The schedule fetching method uses these settings to gather
              your schedule. Please make sure it is correct and matches your record.</p>
            <p></p>
            <p>This data is not saved to a database or external source.</p>
          </div>
        </div>
      </div>

      <form class="needs-validation" id="settings" name="settings" method="post" novalidate>

        <div class="mb-3">
          <label for="firstName" class="form-label">First Name</label>
          <input type="text" class="form-control" id="firstName" aria-describedby="firstName" required>
          <div class="invalid-feedback">
            Please provide a valid first name that matches your schedule records.
          </div>
        </div>

        <div class="mb-3">
          <label for="lastName" class="form-label">Last Name</label>
          <input type="text" class="form-control" id="lastName" aria-describedby="lastName" required>
          <div class="invalid-feedback">
            Please provide a valid last name that matches your schedule records.
          </div>
        </div>

        <div class="mb-3">
          <label for="phoneNumber" class="form-label">Phone Number</label>
          <input type="tel" class="form-control" id="phoneNumber" aria-describedby="phoneNumber">
        </div>

        <div class="mb-3">
          <label for="emailAddress" class="form-label">Email address</label>
          <input type="email" class="form-control" id="emailAddress" aria-describedby="email">
        </div>

        <h6>Instructor Schedule Authentication</h6>

        <div class="mb-3">
          <label for="fullName" class="form-label">Full Name</label>
          <input type="text" class="form-control" id="fullName" aria-describedby="fullName" readonly>
          <div class="valid-feedback">
            Match
          </div>
          <div class="invalid-feedback">
            Full name does not match schedule records.
          </div>
        </div>

        <div class="mb-3">
          <label for="skiArea" class="form-label">Ski Area</label>
          <input type="text" class="form-control" id="skiArea" aria-describedby="ski area" required>
          <div class="valid-feedback">Match</div>
        </div>

        <div class="mb-3">
          <label for="passNumber" class="form-label">Pass Number</label>
          <input type="number" class="form-control" id="passNumber" aria-describedby="pass number" required>
          <div class="valid-feedback">Valid</div>
          <div class="invalid-feedback">
            This passnumber is invalid.
          </div>
        </div>

        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <input type="password" class="form-control" id="password" aria-describedby="password" required>
          <div id="passwordHelp" class="form-text">Login password for instructor.snow.com</div>
          <div class="valid-feedback">Valid</div>
          <div class="invalid-feedback">
            Password is possibly incorrect.
          </div>
        </div>

        <div class="mb-3">
          <input class="form-check-input" type="checkbox" value="" id="validated">
          <label class="form-check-label" for="validated">
            Credentials Validated
          </label>
        </div>


        <h6>Include Past Seasons</h6>

        <div class="mb-3">
          <label for="seasonRange" class="form-label text-center" style="display:block;">
            <div class="row justify-content-between ">
              <div class="col">2024</div>
              <div class="col">2022</div>
              <div class="col">2020</div>
              <div class="col">2018</div>
              <div class="col">2016</div>
              <div class="col">2014</div>
            </div>
          </label>
          <input type="range" class="form-range" min="0" max="10" step="1" value="0" id="seasonRange"
            oninput="this.nextElementSibling.value = 2024 - this.value">
          <output id="seasonOutput" style="display: block; text-align:center;">2024</output>
        </div>

        <div class="mb-3">
          <button type="submit" class="btn btn-dark">Save</button>
        </div>

      </form>

    </div>
  </main>
  <footer class="mt-auto py-3 my-0">
    <div class="d-flex flex-wrap justify-content-center">
    </div>

    <ul class="nav justify-content-center mb-3">
      <li class="nav-item"><a href="schedule.html" class="nav-link px-2 text-body-light">Schedule</a></li>
      <li class="nav-item"><a href="settings.html" class="nav-link px-2 text-body-light">Settings</a></li>
      <li class="nav-item"><a href="guests.html" class="nav-link px-2 text-body-light">Guests</a></li>
    </ul>
    <p class="fs-0 small text-center text-info pb-0 mb-0">Â© 2024 Ski Gaupo, Inc</p>
  </footer>

  <script>
    (() => {
      'use strict'
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      const form = document.querySelector("#settings");

      form.addEventListener("submit", event => {
        event.preventDefault()
        event.stopPropagation()
        if (!form.checkValidity()) {
          console.log("invalid form")
        }
        else {
          saveForm("settings");
        }
        form.classList.add('was-validated');
      }, false);

      const firstName = document.getElementById("firstName");
      firstName.addEventListener("input", event => {
        // full name
        fullNameValue();
      }, false);

      const lastName = document.getElementById("lastName");
      lastName.addEventListener("input", event => {
        fullNameValue();
      }, false);

      const passNumber = document.getElementById("passNumber");
      const passWord = document.getElementById("password");
      passNumber.addEventListener("change", event => {

        passNumber.setCustomValidity("");

        if( !passNumber.validity.valid) {

          return; 
        }
        validateUser.initiate();
      }, false);
      passWord.addEventListener("change", event => {
        validateUser.initiate();
      }, false);
    })()
  </script>

  <script>

    function fullNameValue() {
      let fullName = document.getElementById("fullName");
      let firstName = document.getElementById("firstName");
      let lastName = document.getElementById("lastName");
      fullName.value = firstName.value + ' ' + lastName.value;
    }

    function saveForm(formId) {
      const form = document.getElementById(formId);
      if (form) {
        const output = {};
        const inputs = form.querySelectorAll("input");
        inputs.forEach(input => {
          var key = input.id;
          var value = input.value;
          output[key] = value;
        });
        localStorage.setItem("settings", JSON.stringify(output));

        // validate the credentials
        validateUser.initiate();
      }
    }

    function localStorageSettings() {
      const requiredKeys = ["firstName", "lastName", "skiArea", "passNumber", "password", "validated"];
      // does it exist? no ->
      if (localStorage.getItem('settings') == null) {
        // save the blank object 
        const obj = {};
        requiredKeys.forEach(key => {
          if (!obj.hasOwnProperty(key)) {
            obj[key] = "";
          }
        });
        localStorage.setItem("settings", JSON.stringify(obj));
      }
      // is it formed as an object? no ->
      // are all the correct keys included in the object
      if (localStorage.getItem('settings')) {
        const obj = JSON.parse(localStorage.getItem('settings'));
        requiredKeys.forEach(key => {
          if (!obj.hasOwnProperty(key)) {
            obj[key] = "";
            errorDisplay.throw("Settings Error", key + " is missing.");
          }
        });
      }
      const local = JSON.parse(localStorage.getItem("settings"));
      return local;
    }

    function loadForm(formId) {
      const form = document.getElementById(formId);

      if (!form) {
        console.error("no form with id: ", formId);
        return;
      }

      // get the localStorage item validated            
      const formValueDict = localStorageSettings();

      const inputs = form.querySelectorAll("input");
      inputs.forEach(input => {
        if (formValueDict.hasOwnProperty(input.id)) {
          input.value = formValueDict[input.id];
          if (input.type == "checkbox") {
            input.value = formValueDict[input.id];
            input.checked = false;
            if (formValueDict[input.id]) {
              input.checked = true;
            }
          }
          if (input.id == "seasonRange") {
            // set output if exists          
            if (input.nextElementSibling.type == 'output') {
              input.nextElementSibling.value = (new Date()).getFullYear() - parseInt(formValueDict[input.id]);
            }
          }
        }
      });

      fullNameValue();
    }
  </script>

  <script>
    loadForm("settings")
  </script>
  <script src="script/validate.js"></script>
  
</body>

</html>